<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marcador Billar - Pepos Premium</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ===== ESTILOS PARA PANTALLA √öNICA (NO SCROLL) ===== */
* { box-sizing: border-box; }

body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    color: white;
    background-image: url("./IMAGEN/Pepos.jpg"); 
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    background-color: #111;
    height: 100vh; /* Altura estricta */
    overflow: hidden; /* Proh√≠be el scroll en la p√°gina entera */
}

/* Efecto Vidrio Esmerilado */
.glass-effect {
    background: rgba(15, 15, 15, 0.75);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(212, 175, 55, 0.2);
    box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.5);
    border-radius: 15px;
}

/* PANTALLA LOGIN */
#loginOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999; flex-direction: column;
}
.loginBox { padding: 40px; text-align: center; }
.loginBox h2 { color: #FFD700; margin-bottom: 25px; font-weight: 800; letter-spacing: 2px; }
.loginBox input { 
    padding: 15px; font-size: 18px; border-radius: 10px; border: 1px solid rgba(255,215,0,0.3); 
    text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); color: white;
    font-family: 'Poppins', sans-serif; outline: none; transition: all 0.3s;
}

/* CONTENEDOR PRINCIPAL FLEXIBLE */
.contenedor {
    display: none; 
    flex-direction: column;
    justify-content: space-between;
    height: 100vh; 
    padding: 1.5vh 1.5vw; 
    gap: 1vh;
}

/* CABECERA */
.header-box { padding: 1vh; text-align: center; }
.titulo { color: #FFD700; font-size: 4vh; font-weight: 800; text-shadow: 0 3px 10px rgba(0,0,0,0.8); margin: 0; }
.mesaEditable {
    font-size: 2.5vh; color: #fff; background: transparent; border: none;
    border-bottom: 2px dashed #D4AF37; text-align: center; width: 60px;
    outline: none; font-family: 'Poppins', sans-serif; font-weight: 600;
}

/* ZONA MARCADOR (Toma la mayor parte del espacio) */
.marcador {
    flex: 1; /* Se estira para ocupar el centro */
    display: flex; justify-content: center; align-items: center; gap: 3vw;
}
.jugador {
    padding: 2vh 2vw; min-width: 25vw;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.jugador input {
    font-size: 3vh; text-align: center; padding: 5px; border: none; border-bottom: 2px solid transparent;
    background: transparent; color: white; font-weight: 600; margin-bottom: 0;
    font-family: 'Poppins', sans-serif; width: 100%; outline: none;
}
.puntos {
    font-size: 15vh; color: #FFD700; font-weight: 800; text-shadow: 0 5px 15px rgba(0,0,0,0.5);
    margin: 1vh 0; display: inline-block; line-height: 1;
}

/* ANIMACI√ìN PUNTOS */
@keyframes popEffect {
    0% { transform: scale(1); } 50% { transform: scale(1.2); color: #FFF; text-shadow: 0 0 30px #FFD700; } 100% { transform: scale(1); }
}
.animar-punto { animation: popEffect 0.3s ease-out; }

/* BOTONES */
button {
    font-size: 1.8vh; padding: 1vh 2vw; margin: 3px; border: none; border-radius: 8px;
    cursor: pointer; background: linear-gradient(135deg, #FFDF00 0%, #D4AF37 100%);
    color: #111; font-weight: 800; font-family: 'Poppins', sans-serif;
    text-transform: uppercase; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: all 0.2s;
}
button:hover { transform: translateY(-2px); filter: brightness(1.1); }
button:active { transform: translateY(1px); }
button.restar { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }

.vs { font-size: 4vh; font-weight: 800; color: rgba(255,255,255,0.5); }

/* ZONA INFERIOR (Ajustada en 4 columnas para que no ocupe a lo alto) */
.bottom-row {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    gap: 1vw;
    height: 25vh; /* Altura m√°xima fija */
}

.bottom-box {
    flex: 1; 
    padding: 1.5vh 1vw; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    overflow-y: auto; /* Scroll interno solo si es necesario */
}
/* Ocultar barra de scroll interna para mantenerlo limpio */
.bottom-box::-webkit-scrollbar { width: 5px; }
.bottom-box::-webkit-scrollbar-thumb { background: rgba(212, 175, 55, 0.5); border-radius: 5px; }

.bottom-box h3 { color: #FFD700; margin: 0 0 1vh 0; font-size: 1.8vh; text-transform: uppercase; border-bottom: 1px solid rgba(255,215,0,0.3); padding-bottom: 5px; width: 100%; text-align: center;}

/* Puntos objetivo */
.config-box input { padding: 5px; border-radius: 5px; border: none; text-align: center; font-size: 2vh; width: 60px; font-weight: bold; margin: 5px 0 10px 0;}

/* QR Code */
#contenedorQR { background: white; padding: 10px; border-radius: 10px; }
#contenedorQR img { width: 10vh; height: 10vh; }

/* CELEBRACI√ìN */
.celebracion {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); display: none;
    justify-content: center; align-items: center; flex-direction: column; z-index: 9999;
}
.celebracion.activa { display: flex; animation: fadeIntro 0.5s ease; }
@keyframes fadeIntro { from { opacity: 0; } to { opacity: 1; } }
@keyframes reboteTexto { 0% { transform: scale(1); } 50% { transform: scale(1.1); text-shadow: 0 0 40px #FFD700; } 100% { transform: scale(1); } }
#textoGanador { font-size: 8vh; font-weight: 800; color: #FFD700; text-align: center; text-shadow: 0 0 20px gold; animation: reboteTexto 1.5s infinite alternate ease-in-out; margin-bottom: 3vh;}

</style>
</head>

<body>

<div id="loginOverlay">
    <div class="loginBox glass-effect">
        <h2>BILLARES PEPO</h2>
        <input type="password" id="passInput" placeholder="Contrase√±a secreta...">
        <br>
        <button onclick="validar()" style="padding: 15px 30px; font-size: 16px;">ENTRAR AL TORNEO</button>
    </div>
</div>

<div id="app" class="contenedor">
    <div class="header-box glass-effect">
        <h1 class="titulo">BILLARES PEPO</h1>
        <h2 style="font-weight: 400; margin: 5px 0 0 0; font-size: 2vh;">MESA <input id="mesaInput" class="mesaEditable"></h2>
    </div>

    <div class="marcador">
        <div class="jugador glass-effect">
            <input id="nombreA" value="Jugador 1">
            <div class="puntos" id="puntosA">0</div>
            <div style="display:flex; gap:5px; width: 100%;">
                <button onclick="sumarA()" style="flex:1;">+ PUNTO</button>
                <button class="restar" onclick="restarA()" style="flex:1;">- Quitar</button>
            </div>
        </div>
        
        <div class="vs">VS</div>
        
        <div class="jugador glass-effect">
            <input id="nombreB" value="Jugador 2">
            <div class="puntos" id="puntosB">0</div>
            <div style="display:flex; gap:5px; width: 100%;">
                <button onclick="sumarB()" style="flex:1;">+ PUNTO</button>
                <button class="restar" onclick="restarB()" style="flex:1;">- Quitar</button>
            </div>
        </div>
    </div>

    <div class="bottom-row">
        <div class="bottom-box glass-effect config-box">
            <h3>‚öôÔ∏è Opciones</h3>
            <span style="font-size: 1.5vh; opacity: 0.8;">Puntos para ganar:</span>
            <input id="objetivo" type="number" value="40">
            <button onclick="resetear()" style="background: #e74c3c; color: white; width: 100%; margin-top: auto;">Reiniciar Partida</button>
        </div>

        <div class="bottom-box glass-effect">
            <h3>üì± Remoto</h3>
            <div id="contenedorQR"></div>
            <p style="font-size: 1.2vh; opacity: 0.8; text-align: center; margin: 5px 0 0 0;">Escanea para controlar</p>
        </div>

        <div class="bottom-box glass-effect">
            <h3>üèÜ Top Ranking</h3>
            <div id="ranking" style="text-align: left; width: 100%; font-size: 1.6vh; line-height: 1.6;"></div>
        </div>

        <div class="bottom-box glass-effect">
            <h3>üìà Estad√≠sticas</h3>
            <div id="estadisticas" style="text-align: left; width: 100%; font-size: 1.6vh; line-height: 1.6;"></div>
        </div>
    </div>
</div>

<div class="celebracion" id="celebracion">
    <div id="textoGanador"></div>
    <button onclick="nuevaPartida()" style="font-size: 3vh; padding: 2vh 4vw; border-radius: 50px;">NUEVA PARTIDA</button>
</div>

<script>
// CONFIGURACI√ìN FIREBASE 
const firebaseConfig = { databaseURL: "https://billares-pepo-default-rtdb.firebaseio.com/" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let puntosA = 0, puntosB = 0;
let ranking = {};
let estadisticas = {};

// LOGIN
function validar() {
    if(document.getElementById('passInput').value === 'billar2025') {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('app').style.display = 'flex'; // Cambiado a flex para la estructura responsive
        setTimeout(inicializarQR, 300);
        
        db.ref('datos_jugadores').on('value', (snapshot) => {
            const data = snapshot.val();
            if(data) {
                ranking = data.ranking || {};
                estadisticas = data.estadisticas || {};
                renderDatos();
            }
        });

        db.ref('marcador').on('value', (snapshot) => {
            const data = snapshot.val();
            if(data) {
                if(data.pA !== puntosA) animarNumero("puntosA");
                if(data.pB !== puntosB) animarNumero("puntosB");
                
                puntosA = data.pA;
                puntosB = data.pB;
                actualizarDOM();
                verificar();
            }
        });
    } else { alert("Contrase√±a incorrecta"); }
}

function enviarPuntos() { db.ref('marcador').set({ pA: puntosA, pB: puntosB }); }

function actualizarDOM() {
    document.getElementById("puntosA").textContent = puntosA;
    document.getElementById("puntosB").textContent = puntosB;
}

function animarNumero(idElemento) {
    const el = document.getElementById(idElemento);
    el.classList.remove("animar-punto");
    void el.offsetWidth; 
    el.classList.add("animar-punto");
}

function sumarA() { puntosA++; enviarPuntos(); }
function restarA() { if(puntosA>0) puntosA--; enviarPuntos(); }
function sumarB() { puntosB++; enviarPuntos(); }
function restarB() { if(puntosB>0) puntosB--; enviarPuntos(); }

function verificar() {
    let obj = parseInt(document.getElementById("objetivo").value);
    if(puntosA >= obj) registrarVictoria(document.getElementById('nombreA').value, document.getElementById('nombreB').value, puntosA, puntosB);
    else if(puntosB >= obj) registrarVictoria(document.getElementById('nombreB').value, document.getElementById('nombreA').value, puntosB, puntosA);
}

function registrarVictoria(ganador, perdedor, pG, pP) {
    if(document.getElementById("celebracion").classList.contains("activa")) return;

    ranking[ganador] = (ranking[ganador] || 0) + 1;
    if(!estadisticas[ganador]) estadisticas[ganador] = {jugadas:0, puntos:0};
    if(!estadisticas[perdedor]) estadisticas[perdedor] = {jugadas:0, puntos:0};
    
    estadisticas[ganador].jugadas++; estadisticas[ganador].puntos += pG;
    estadisticas[perdedor].jugadas++; estadisticas[perdedor].puntos += pP;
    
    db.ref('datos_jugadores').set({ ranking: ranking, estadisticas: estadisticas });
    
    document.getElementById("textoGanador").innerHTML = "¬°TENEMOS UN CAMPE√ìN!<br><span style='color:white;'>" + ganador + "</span>";
    document.getElementById("celebracion").classList.add("activa");
    lanzarConfetiProfesional();
}

function renderDatos() {
    let r = "";
    Object.entries(ranking).sort((a,b)=>b[1]-a[1]).forEach(([n,v],i)=> {
        let medalla = i===0 ? "ü•á" : i===1 ? "ü•à" : i===2 ? "ü•â" : "üî∏";
        r += `<b>${medalla} ${n}</b>: ${v} vict.<br>`;
    });
    document.getElementById("ranking").innerHTML = r;
    
    let e = "";
    for(let j in estadisticas) {
        let s = estadisticas[j];
        let prom = s.jugadas > 0 ? (s.puntos/s.jugadas).toFixed(1) : 0;
        e += `<b>${j}</b>: ${s.jugadas}P | Prom: ${prom}<br>`;
    }
    document.getElementById("estadisticas").innerHTML = e;
}

function nuevaPartida() {
    document.getElementById("celebracion").classList.remove("activa");
    resetear();
}

function resetear() { puntosA = 0; puntosB = 0; enviarPuntos(); }

function inicializarQR() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('modo') === 'remoto') {
        // INTERFAZ REMOTA TAMBI√âN SIN SCROLL
        document.body.style.backgroundImage = "none";
        document.body.style.backgroundColor = "#111";
        document.getElementById('app').style.display = 'flex';
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('app').innerHTML = `
            <div style="flex:1; display:flex; flex-direction:column; justify-content:space-evenly; max-width: 500px; margin: auto; width: 100%;">
                <h1 class="titulo" style="font-size: 4vh; text-align: center;">MANDO A DISTANCIA</h1>
                <div class="glass-effect" style="padding: 2vh; text-align: center;">
                    <h2 style="margin:0 0 1vh 0; font-size:2.5vh;">JUGADOR 1</h2>
                    <button onclick="remote(1,0)" style="width:100%; height:15vh; font-size:5vh; border-radius:15px;">+</button>
                    <button class="restar" onclick="remote(-1,0)" style="width:100%; height:8vh; font-size:2vh; margin-top:1vh;">- Quitar Punto</button>
                </div>
                <div class="glass-effect" style="padding: 2vh; text-align: center;">
                    <h2 style="margin:0 0 1vh 0; font-size:2.5vh;">JUGADOR 2</h2>
                    <button onclick="remote(0,1)" style="width:100%; height:15vh; font-size:5vh; border-radius:15px;">+</button>
                    <button class="restar" onclick="remote(0,-1)" style="width:100%; height:8vh; font-size:2vh; margin-top:1vh;">- Quitar Punto</button>
                </div>
            </div>`;
        
        window.remote = (a, b) => {
            if(window.navigator.vibrate) window.navigator.vibrate(50);
            db.ref('marcador').once('value', s => {
                const d = s.val() || {pA:0, pB:0};
                db.ref('marcador').set({ pA: Math.max(0, d.pA + a), pB: Math.max(0, d.pB + b) });
            });
        };
    } else {
        const qrDiv = document.getElementById("contenedorQR");
        qrDiv.innerHTML = "";
        // QR un poco m√°s peque√±o para asegurar que quepa
        new QRCode(qrDiv, { text: window.location.href.split('?')[0] + "?modo=remoto", width: 100, height: 100 });
    }
}

function lanzarConfetiProfesional() {
    var duration = 4000;
    var animationEnd = Date.now() + duration;
    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 10000 };
    function randomInRange(min, max) { return Math.random() * (max - min) + min; }
    var interval = setInterval(function() {
        var timeLeft = animationEnd - Date.now();
        if (timeLeft <= 0) return clearInterval(interval);
        var particleCount = 50 * (timeLeft / duration);
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
    }, 250);
}
</script>
</body>
</html>

